name: Update Documentation on Pull Request Comment

on:
  issue_comment:
    types: [created]

jobs:
  pr_commented:
    name: PR comment
    if: ${{ github.event.issue.pull_request }} && startsWith(github.event.comment.body, 'Documentation ')
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.10'

      - name: Insall dependencies
        run: pip install -r requirements.txt

      - name: Get file path name and comment
        id: extract
        run: |
          COMMENT="${{ github.event.comment.body }}"
          FILE_PATH=$(echo "$COMMENT" | grep -oP '(?<=Documentation\s)[^:]*')
          COMMENT_BODY=$(echo "$COMMENT" | sed 's/^[^:}*: //')
          echo "::set-output name=file_path::$FILE_PATH"
          echo "::set-output name=comment_body::$COMMENT_BODY"

        shell: bash
        env:
          COMMENT: ${{ github.event.comment.body }}

      - name: Update Documentation
        run: |
          python update_app.py --file "$FILE_PATH" --comment "$COMMENT_BODY"
        env:
          FILE_PATH: ${{ steps.extract.outputs.file_path }}
          COMMENT_BODY: ${{ steps.extract.outputs.comment_body }}

      - name: Commit and push changes
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "github-actions"
          git add "$FILE_PATH"
          git commit -m "Update documentation for $FILE_PATH" 
          git pull --rebase
          git push
        env:
          FILE_PATH: ${{ steps.extract.outputs.file_path }}
      
          





